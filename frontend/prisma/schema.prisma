generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "windows"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model brands {
  id          Int        @id @default(autoincrement())
  name        String     @unique @db.VarChar(255)
  description String?    @db.VarChar(500)
  active      Boolean    @default(true)
  image_url   String?    @db.VarChar(255)
  products    products[]
}

model cart {
  id            Int       @id @default(autoincrement())
  user_id       Int?
  session_token String?   @unique @db.Uuid
  subtotal      Int
  created_at    DateTime  @default(now()) @db.Timestamp(6)
  expires_at    DateTime? @db.Timestamp(6)
  users         User?     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model categories {
  id                   Int                    @id @default(autoincrement())
  name                 String                 @db.VarChar(255)
  description          String?                @db.VarChar(500)
  id_subcategory       Int?
  active               Boolean                @default(true)
  subcategory          subcategories?         @relation(fields: [id_subcategory], references: [id], onDelete: NoAction, onUpdate: NoAction)
  category_subcategory category_subcategory[]
  products             products[]
}

model category_subcategory {
  category_id    Int
  subcategory_id Int
  active         Boolean       @default(true)
  categories     categories    @relation(fields: [category_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  subcategories  subcategories @relation(fields: [subcategory_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([category_id, subcategory_id])
}

model coupons {
  id                  Int      @id @default(autoincrement())
  code                String   @db.VarChar(50)
  name                String   @db.VarChar(100)
  discount_type       String   @db.VarChar(255)
  discount_value      Decimal  @db.Decimal(10, 2)
  min_purchase_amount Decimal? @default(0) @db.Decimal(10, 2)
  usage_limit         Int?
  usage_count         Int?     @default(0)
  active              Boolean  @default(true)
  created_by          Int
  created_at          DateTime @default(now()) @db.Timestamp(6)
  expires_at          DateTime @db.Timestamp(6)
}

model products {
  id               Int                @id @default(autoincrement())
  name             String             @db.VarChar(255)
  description      String             @db.VarChar(500)
  price            Int
  stock            Int
  weight_grams     Int
  sizes            String             @db.VarChar(255)
  base_discount    Decimal            @default(0) @db.Decimal(8, 2)
  category_id      Int
  brand_id         Int
  active           Boolean            @default(true)
  in_offer         Boolean            @default(false)
  offer_discount   Decimal?           @db.Decimal(10, 2)
  offer_start_date DateTime?          @db.Timestamp(6)
  offer_end_date   DateTime?          @db.Timestamp(6)
  created_at       DateTime           @default(now()) @db.Timestamp(6)
  created_by       Int
  updated_at       DateTime?          @db.Timestamp(6)
  updated_by       Int
  product_variants product_variants[]
  brands           brands             @relation(fields: [brand_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  categories       categories         @relation(fields: [category_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model User {
  id                  Int        @id @default(autoincrement())
  name                String     @db.VarChar(255)
  email               String     @unique @db.VarChar(255)
  email_verified      DateTime?  @db.Timestamp(6)
  password            String?    @db.VarChar(255)
  image               String?    @db.VarChar(255)
  phone_number        String?    @unique @db.VarChar(20)
  identification      String?    @unique @db.VarChar(20)
  identification_type String?    @db.VarChar(10)
  role                roles_enum @default(user)
  active              Boolean    @default(true)
  email_notifications Boolean    @default(true)
  created_at          DateTime   @default(now()) @db.Timestamp(6)
  updated_at          DateTime?  @db.Timestamp(6)
  cart                cart[]
}

model subcategories {
  id                   Int                    @id @default(autoincrement())
  name                 String                 @db.VarChar(255)
  active               Boolean                @default(true)
  categories           categories[]
  category_subcategory category_subcategory[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model product_variants {
  id           Int       @id @default(autoincrement())
  product_id   Int
  color_code   String    @db.VarChar(7)
  size         String    @db.VarChar(25)
  stock        Int
  sku          String?   @db.VarChar(100)
  price        Int?
  weight_grams Int?
  active       Boolean   @default(true)
  created_at   DateTime  @default(now()) @db.Timestamp(6)
  updated_at   DateTime? @db.Timestamp(6)
  products     products  @relation(fields: [product_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([product_id, color_code, size], map: "unq_product_variant")
}

enum orders_paymentmethod_enum {
  paypal
  nequi
  efecty
}

enum orders_status_enum {
  pending
  paid
  processing
  shipped
  delivered
}

enum roles_enum {
  user
  admin
}

enum return_status_enum {
  requested
  approved
  rejected
  processed
  refunded
}
