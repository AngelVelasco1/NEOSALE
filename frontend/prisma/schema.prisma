generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "windows"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model brands {
  id          Int        @id @default(autoincrement())
  name        String     @unique @db.VarChar(255)
  description String?    @db.VarChar(500)
  active      Boolean    @default(true)
  image_url   String?    @db.VarChar(255)
  products    products[]
}

model cart {
  id            Int          @id @default(autoincrement())
  user_id       Int?
  session_token String?      @unique @db.Uuid
  subtotal      Int
  created_at    DateTime     @default(now()) @db.Timestamp(6)
  expires_at    DateTime?    @db.Timestamp(6)
  users         User?        @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  cart_items    cart_items[]
}

model categories {
  id                   Int                    @id @default(autoincrement())
  name                 String                 @db.VarChar(255)
  description          String?                @db.VarChar(500)
  id_subcategory       Int?
  active               Boolean                @default(true)
  subcategory          subcategories?         @relation(fields: [id_subcategory], references: [id], onDelete: NoAction, onUpdate: NoAction)
  category_subcategory category_subcategory[]
  products             products[]
}

model category_subcategory {
  category_id    Int
  subcategory_id Int
  active         Boolean       @default(true)
  categories     categories    @relation(fields: [category_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  subcategories  subcategories @relation(fields: [subcategory_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([category_id, subcategory_id])
}

model coupons {
  id                  Int      @id @default(autoincrement())
  code                String   @db.VarChar(50)
  name                String   @db.VarChar(100)
  discount_type       String   @db.VarChar(255)
  discount_value      Decimal  @db.Decimal(10, 2)
  min_purchase_amount Decimal? @default(0) @db.Decimal(10, 2)
  usage_limit         Int?
  usage_count         Int?     @default(0)
  active              Boolean  @default(true)
  created_by          Int
  created_at          DateTime @default(now()) @db.Timestamp(6)
  expires_at          DateTime @db.Timestamp(6)
  orders              orders[]
}

/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model products {
  id               Int                @id @default(autoincrement())
  name             String             @db.VarChar(255)
  description      String             @db.VarChar(500)
  price            Int
  stock            Int
  weight_grams     Int
  sizes            String             @db.VarChar(255)
  base_discount    Decimal            @default(0) @db.Decimal(8, 2)
  category_id      Int
  brand_id         Int
  active           Boolean            @default(true)
  in_offer         Boolean            @default(false)
  offer_discount   Decimal?           @db.Decimal(10, 2)
  offer_start_date DateTime?          @db.Timestamp(6)
  offer_end_date   DateTime?          @db.Timestamp(6)
  created_at       DateTime           @default(now()) @db.Timestamp(6)
  created_by       Int
  updated_at       DateTime?          @db.Timestamp(6)
  updated_by       Int
  cart_items       cart_items[]
  favorites        favorites[]
  images           images[]
  order_items      order_items[]
  product_variants product_variants[]
  brands           brands             @relation(fields: [brand_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  categories       categories         @relation(fields: [category_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  reviews          reviews[]
}

model User {
  id                  Int          @id @default(autoincrement())
  name                String       @db.VarChar(255)
  email               String       @unique @db.VarChar(255)
  email_verified      DateTime?    @db.Timestamp(6)
  password            String?      @db.VarChar(255)
  image               String?      @db.VarChar(255)
  phone_number        String?      @unique @db.VarChar(20)
  identification      String?      @unique @db.VarChar(20)
  identification_type String?      @db.VarChar(10)
  role                roles_enum   @default(user)
  active              Boolean      @default(true)
  email_notifications Boolean      @default(true)
  created_at          DateTime     @default(now()) @db.Timestamp(6)
  updated_at          DateTime?    @db.Timestamp(6)
  Account             Account[]
  addresses           addresses[]
  cart                cart[]
  favorites           favorites[]
  order_logs          order_logs[]
  orders              orders[]
  reviews             reviews[]
}

model subcategories {
  id                   Int                    @id @default(autoincrement())
  name                 String                 @db.VarChar(255)
  active               Boolean                @default(true)
  categories           categories[]
  category_subcategory category_subcategory[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model product_variants {
  id           Int       @id @default(autoincrement())
  product_id   Int
  color_code   String    @db.VarChar(7)
  size         String    @db.VarChar(25)
  stock        Int
  sku          String?   @db.VarChar(100)
  price        Int?
  weight_grams Int?
  active       Boolean   @default(true)
  created_at   DateTime  @default(now()) @db.Timestamp(6)
  updated_at   DateTime? @db.Timestamp(6)
  images       images[]
  products     products  @relation(fields: [product_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([product_id, color_code, size], map: "unq_product_variant")
}

model Account {
  user_id             Int
  type                String   @db.VarChar(255)
  provider            String   @db.VarChar(255)
  provider_account_id String   @db.VarChar(255)
  refresh_token       String?
  access_token        String?
  expires_at          Int?
  token_type          String?  @db.VarChar(255)
  scope               String?  @db.VarChar(255)
  id_token            String?
  session_state       String?  @db.VarChar(255)
  created_at          DateTime @default(now()) @db.Timestamp(6)
  updated_at          DateTime @default(now()) @db.Timestamp(6)
  User                User     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@id([provider, provider_account_id])
}

model addresses {
  id         Int      @id @default(autoincrement())
  address    String   @db.VarChar(255)
  country    String   @db.VarChar(255)
  city       String   @db.VarChar(255)
  department String   @db.VarChar(255)
  is_default Boolean
  user_id    Int
  created_at DateTime @default(now()) @db.Timestamp(6)
  User       User     @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model cart_items {
  id         Int      @id @default(autoincrement())
  cart_id    Int
  product_id Int
  quantity   Int
  unit_price Int
  color_code String   @db.VarChar(7)
  size       String   @db.VarChar(25)
  cart       cart     @relation(fields: [cart_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  products   products @relation(fields: [product_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model favorites {
  id         Int      @id @default(autoincrement())
  user_id    Int
  product_id Int
  created_at DateTime @default(now()) @db.Timestamp(6)
  products   products @relation(fields: [product_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  User       User     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([user_id, product_id], map: "unq_user_product_favorite")
}

model images {
  id               Int               @id @default(autoincrement())
  image_url        String            @db.VarChar(255)
  color_code       String            @db.VarChar(7)
  color            String            @db.VarChar(255)
  is_primary       Boolean?          @default(false)
  product_id       Int
  variant_id       Int?
  products         products          @relation(fields: [product_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  product_variants product_variants? @relation(fields: [variant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model order_items {
  id         Int       @id @default(autoincrement())
  price      Int
  quantity   Int
  subtotal   Int
  product_id Int
  order_id   Int
  created_at DateTime  @default(now()) @db.Timestamp(6)
  updated_at DateTime? @db.Timestamp(6)
  orders     orders    @relation(fields: [order_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  products   products  @relation(fields: [product_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model order_logs {
  id              Int                @id @default(autoincrement())
  previous_status orders_status_enum
  new_status      orders_status_enum
  note            String?            @db.VarChar(500)
  order_id        Int
  created_at      DateTime           @default(now()) @db.Timestamp(6)
  updated_at      DateTime?          @db.Timestamp(6)
  updated_by      Int
  user_type       String?            @default("admin") @db.VarChar(20)
  orders          orders             @relation(fields: [order_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  User            User               @relation(fields: [updated_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model orders {
  id                  Int                 @id @default(autoincrement())
  status              orders_status_enum
  subtotal            Int
  discount            Int?                @default(0)
  shipping_cost       Int
  taxes               Int
  total               Int
  payment_method      payment_method_enum
  payment_status      String?             @default("pending") @db.VarChar(20)
  transaction_id      String?             @db.VarChar(255)
  paid_at             DateTime?           @db.Timestamp(6)
  shipping_address_id Int
  user_note           String?             @db.VarChar(255)
  created_at          DateTime            @default(now()) @db.Timestamp(6)
  updated_at          DateTime?           @db.Timestamp(6)
  shipped_at          DateTime?           @db.Timestamp(6)
  delivered_at        DateTime?           @db.Timestamp(6)
  updated_by          Int
  user_id             Int
  coupon_id           Int?
  order_items         order_items[]
  order_logs          order_logs[]
  coupons             coupons?            @relation(fields: [coupon_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  User                User                @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model review_images {
  id         Int      @id @default(autoincrement())
  review_id  Int
  image_url  String   @db.VarChar(500)
  created_at DateTime @default(now()) @db.Timestamp(6)
  reviews    reviews  @relation(fields: [review_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model reviews {
  id            Int             @id @default(autoincrement())
  user_id       Int
  product_id    Int
  rating        Int
  comment       String?
  created_at    DateTime        @default(now()) @db.Timestamp(6)
  updated_at    DateTime?       @db.Timestamp(6)
  review_images review_images[]
  products      products        @relation(fields: [product_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  User          User            @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

enum orders_status_enum {
  pending
  confirmed
  paid
  processing
  shipped
  delivered
  cancelled
  refunded
}

enum roles_enum {
  user
  admin
}

enum return_status_enum {
  requested
  approved
  rejected
  processed
  refunded
}

enum notification_type_enum {
  order_confirmed
  order_shipped
  order_delivered
  price_drop
  back_in_stock
  review_request
  promotion
}

enum payment_method_enum {
  paypal
  efecty
  pse
  credit_card
  debit_card
  mercadopago
}

enum orders_paymentmethod_enum {
  paypal
  nequi
  efecty
}
